<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datei-Transfer</title>
    <!-- Bisherige Styling-Einstellungen bleiben unverändert -->
</head>
<body>
    <!-- Bisheriger HTML-Inhalt bleibt gleich -->

    <script>
        document.getElementById('fileInput').addEventListener('change', function() {
            let file = this.files[0];
            if (!file) return;

            let formData = new FormData();
            formData.append("file", file);

            let xhr = new XMLHttpRequest();
            xhr.open("POST", "https://home-ujmu.onrender.com/upload", true);

            let startTime = Date.now();
            document.getElementById("progressContainer").style.display = "block";
            document.getElementById("warning").style.display = "block";

            xhr.upload.onprogress = function(event) {
                if (event.lengthComputable) {
                    let percentComplete = Math.round((event.loaded / event.total) * 100);
                    document.getElementById("progressFill").style.width = percentComplete + "%";
                    document.getElementById("progressText").textContent = "Hochladen: " + percentComplete + "%";

                    let elapsedTime = (Date.now() - startTime) / 1000;
                    let speed = event.loaded / elapsedTime;
                    let remainingTime = (event.total - event.loaded) / speed;

                    let minutes = Math.floor(remainingTime / 60);
                    let seconds = Math.floor(remainingTime % 60);

                    document.getElementById("timeLeft").textContent = `Verbleibende Zeit: ${minutes}m ${seconds}s`;

                    if (percentComplete === 100) {
                        document.getElementById("uploadAlmostDone").style.display = "block";
                    }
                }
            };

            xhr.onload = function() {
                if (xhr.status == 200) {
                    let response = JSON.parse(xhr.responseText);
                    let downloadURL = response.url;

                    // ✅ Link anzeigen
                    document.getElementById("progressContainer").style.display = "none";
                    document.getElementById("linkBox").style.display = "block";
                    document.getElementById("downloadLink").value = downloadURL;

                    // Änderung: Erweiterung der Download-Logik
                    document.getElementById("downloadLink").addEventListener("click", function() {
                        // Erstelle einen temporären Link, der den Download direkt startet
                        let link = document.createElement("a");
                        link.href = downloadURL;
                        link.setAttribute("download", ""); // Erzwingt den Download
                        link.click(); // Startet den Download
                    });
                }
            };

            xhr.send(formData);
        });

        // Bisheriger Copy-Button-Code bleibt unverändert
    </script>

    <!-- Bisheriger Footer bleibt unverändert -->
</body>
</html>
